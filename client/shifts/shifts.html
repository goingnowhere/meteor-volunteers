<!-- main template to display list-items of duties for a user : shift, tasks, lead -->
<template name="dutiesListItem">
  <div class="row">
    <div class="col">
      {{#if $eq duty.type "project"}}
        {{> projectDate duty }}
      {{else}}
        {{> shiftDate duty }}
      {{/if}}
    </div>
    <div class="col-lg-6 col-md-8 col-sm-10">
      {{#if $eq duty.type "shift"}}
        {{> shiftTitle duty=duty team=team}}
      {{/if}}
      {{#if $eq duty.type "task"}}
        {{> taskTitle duty=duty team=team}}
      {{/if}}
      {{#if $eq duty.type "project"}}
        {{> projectTitle duty=duty team=team}}
      {{/if}}
      {{#if $eq duty.type "lead"}}
        {{> leadTitle duty=duty team=team}}
      {{/if}}
    </div>
    <div class="col">
      {{#if $and signup.status ($neq signup.status 'bailed')}}
        <button class="btn btn-default btn-action disabled
          {{#if $eq signup.status 'confirmed'}}btn-success{{/if}}">
          {{__ signup.status }}
        </button>
      {{else}}
        <!-- {{#if $eq signup.status 'bailed'}}
          <button class="btn btn-default disabled">
            {{__ signup.status }}
          </button>
        {{/if}} -->
        {{#unless $eq duty.policy "adminOnly"}}
          <button class="btn btn-primary btn-action" data-shiftid="{{duty._id}}"
            data-parentid="{{duty.parentId}}" data-type="{{duty.type}}" data-action="apply">
            {{#if $eq duty.type "project"}}
              {{__ ".choose_date"}}
            {{else}}
              {{#if $eq duty.policy "public"}}{{__ ".join"}}{{/if}}
              {{#if $eq duty.policy "requireApproval"}}{{__ ".apply"}}{{/if}}
            {{/if}}
          </button>
        {{else}}
          {{__ ".admin_only"}}
        {{/unless}}
      {{/if}}
      {{#if canBail}}
        <button class="btn btn-danger btn-action" data-shiftid="{{duty._id}}"
          data-parentid="{{duty.parentId}}}" data-type="{{duty.type}}" data-action="bail">
          {{__ "bail"}}
        </button>
      {{/if}}
    </div>
  </div>
  <div class="row">
    <div class="col">
      {{#if $eq duty.type "shift"}}
        {{>shiftBody duty=duty team=team}}
      {{/if}}
      {{#if $eq duty.type "task"}}
        {{>taskBody duty=duty team=team}}
      {{/if}}
      {{#if $eq duty.type "lead"}}
        {{>leadBody duty=duty team=team}}
      {{/if}}
      {{#if $eq duty.type "project"}}
        {{>projectBody duty=duty team=team}}
      {{/if}}
    </div>
  </div>
  <div class="row no-gutters">
    {{#if team.quirks}}
      <ul class="list-inline">
        {{#each quirk in team.quirks}}
          <li class="list-inline-item">
            <span class="badge badge-primary badge-pill">{{quirk}}</span>
          </li>
        {{/each}}
      </ul>
    {{/if}}
    {{#if team.skills}}
      <ul class="list-inline">
        {{#each skill in team.skills}}
          <li class="list-inline-item">
            <span class="badge badge-secondary badge-pill">{{skill}}</span>
          </li>
        {{/each}}
      </ul>
    {{/if}}
  </div>
</template>

<template name="dutiesListItemGroupped">
  <div class="row justify-content-between align-content-center no-gutters">
    <div class="col">
      {{> dutiesListItemTitle duties.group.[0] }}
    </div>
  </div>
  <div class="row justify-content-between align-content-center no-gutters">
    <div class="col">
      {{> dutiesListItemContent duties.group.[0] }}
    </div>
  </div>
  <div class="item-unstyled pt-2">
    {{#each duty in duties.group }}
      <div class="list-item">{{> dutiesListItemDate duty }}</div>
    {{/each}}
  </div>
</template>

<template name="dutiesListItemDate">
  <div class="row justify-content-between align-content-center no-gutters">
    <div class="col">
      <div class="row">
        {{#if $eq duty.type "project"}}
          {{> projectDate duty }}
        {{else}}
          {{> shiftDate duty }}
        {{/if}}
      </div>
    </div>
    <div class="col p-0">
      {{#if $and signup.status ($neq signup.status 'bailed')}}
        <button class="btn btn-default btn-action disabled
          {{#if $eq signup.status 'confirmed'}}btn-success{{/if}}">
          {{__ signup.status }}
        </button>
      {{else}}
        <!-- {{#if $eq signup.status 'bailed'}}
          <button class="btn btn-default disabled">
            {{__ signup.status }}
          </button>
        {{/if}} -->
        {{#unless $eq duty.policy "adminOnly"}}
          <button class="btn btn-primary btn-action" data-shiftid="{{duty._id}}"
            data-parentid="{{duty.parentId}}" data-type="{{duty.type}}" data-action="apply">
            {{#if $eq duty.type "project"}}
              {{__ ".choose_date"}}
            {{else}}
              {{#if $eq duty.policy "public"}}{{__ ".join"}}{{/if}}
              {{#if $eq duty.policy "requireApproval"}}{{__ ".apply"}}{{/if}}
            {{/if}}
          </button>
        {{else}}
          {{__ ".admin_only"}}
        {{/unless}}
      {{/if}}
      {{#if canBail}}
        <button class="btn btn-danger btn-action" data-shiftid="{{duty._id}}"
          data-parentid="{{duty.parentId}}}" data-type="{{duty.type}}" data-action="bail">
          {{__ "bail"}}
        </button>
      {{/if}}
    </div>
  </div>
</template>

<template name="dutiesListItemContent">
  <div class="row no-gutters">
    {{#if $eq duty.type "shift"}}
      {{>shiftBody duty=duty team=team}}
    {{/if}}
    {{#if $eq duty.type "task"}}
      {{>taskBody duty=duty team=team}}
    {{/if}}
    {{#if $eq duty.type "lead"}}
      {{>leadBody duty=duty team=team}}
    {{/if}}
    {{#if $eq duty.type "project"}}
      {{>projectBody duty=duty team=team}}
    {{/if}}
  </div>
  <div class="row no-gutters">
    {{#if team.quirks}}
      <ul class="list-inline">
        {{#each quirk in team.quirks}}
          <li class="list-inline-item">
            <span class="badge badge-primary badge-pill">{{quirk}}</span>
          </li>
        {{/each}}
      </ul>
    {{/if}}
    {{#if team.skills}}
      <ul class="list-inline">
        {{#each skill in team.skills}}
          <li class="list-inline-item">
            <span class="badge badge-secondary badge-pill">{{skill}}</span>
          </li>
        {{/each}}
      </ul>
    {{/if}}
  </div>
</template>

<template name="dutiesListItemTitle">
  {{#if $eq duty.type "shift"}}
    {{> shiftTitle duty=duty team=team}}
  {{/if}}
  {{#if $eq duty.type "task"}}
    {{> taskTitle duty=duty team=team}}
  {{/if}}
  {{#if $eq duty.type "project"}}
    {{> projectTitle duty=duty team=team}}
  {{/if}}
  {{#if $eq duty.type "lead"}}
    {{> leadTitle duty=duty team=team}}
  {{/if}}
</template>

<!-- Create a new shift give for a given team
   args: Team
-->
<template name="addShift">
  {{> insertUpdateTemplate form=form data=data }}
</template>

<!-- Create a new task give for a given team
   args: Team
-->
<template name="addTask">
  {{> insertUpdateTemplate form=form data=data }}
</template>

<template name="addProject">
  {{> insertUpdateTemplate form=form data=data }}
</template>

<Template name="projectStaffingInput">
  {{! Wrapper div with this.atts needed to wire it into autoform}}
  <div {{this.atts}}>
    {{#if datesSet}}
      <div class="row">
        <div class="col-md-4 offset-md-4">
          {{__ ".min_people"}}
        </div>
        <div class="col-md-4">
          {{__ ".max_people"}}
        </div>
      </div>
      {{#each staffingValue in staffingArray}}
        <div class="row" data-index="{{@index}}">
          <div class="col-md-4">
            {{day @index}}
          </div>
          <div class="col-md-4">
            <input data-field="min" type="number" name="{{this.atts.name}}.{{@index}}.min" value="{{staffingValue.[min]}}" class="form-control" />
          </div>
          <div class="col-md-4">
            <input data-field="max" type="number" name="{{this.atts.name}}.{{@index}}.max" value="{{staffingValue.[max]}}" class="form-control" />
          </div>
        </div>
      {{/each}}
    {{/if}}
  </div>
</Template>

<template name="shiftsTasksTableRowView">
  <div>
    <a href="{{pathFor teamViewEventName _id=teamId}}">{{teamName}}</a>:
    {{title}}
    {{#if $and ($eq type "lead") ($eq status "pending")}} {{fa "exclamation-triangle"}}{{/if}}
  </div>
  <div>
    {{#if $eq type "shift"}}{{fa "calendar"}}
    {{else $eq type "task"}}{{fa "tasks"}}
    {{else $eq type "lead"}}{{fa "user-circle"}}
    {{/if}}
    {{#if $eq type "task"}}
      {{> taskDate shift}}
    {{else $eq type "shift"}}
      {{> shiftDate shift}}
    {{/if}}
  </div>
</template>

<!-- helper display to format the date of a shift. used in dutiesListItem and ... -->
<template name="shiftDate">
  <div class="container-fluid">
    <div class="row">
      {{#if sameDay start end}}
        <div class="col"><h5>{{formatDate start}}</h5></div>
        <div class="col"><h6>{{formatTime start}} <br> {{formatTime end}}</h6></div>
      {{else}}
        <div class="col align-content-center"><h5>{{formatDateTime start}}</h5></div>
        <div class="col align-content-center"><h6>{{formatTime end}} {{differenceTime start end}}</h6></div>
      {{/if}}
    </div>
  </div>
</template>

<template name="shiftDateInline">
  {{#if sameDay start end}}
    <h6>{{formatDateTime start}} - {{formatTime end}}</h6>
  {{else}}
    <h6>{{formatDateTime start}} - {{formatTime end}} {{differenceTime start end}}</h6>
  {{/if}}
</template>

<template name="projectDate">
  <div class="container-fluid">
    <div class="row">
      <div class="col"><h5 class="mb-0">{{formatDate start}}</h5><h6>{{longformDay start}}</h6></div>
      <div class="col"><h5 class="mb-0">{{formatDate end}}</h5><h6>{{longformDay end}}</h6></div>
    </div>
  </div>
</template>

<template name="projectDateInline">
  <h6>{{formatDate start }} - {{formatDate end }}</h6>
</template>

<!-- helper display to format the date of a task. used in dutiesListItem and ... -->
<template name="taskDate">
  <!-- <div class="row">{{> taskDate duty}}</div> -->
  <div class="row">{{__ ".estimated_time"}} {{estimatedTime}}</div>
</template>

<template name="shiftTitle">
  <h5 class="mb-1 mr-auto"><small>{{fa "calendar"}} </small>{{team.name}}: {{duty.title}}</h5>
</template>

<template name="taskTitle">
  <h5 class="mb-1 mr-auto"><small>{{fa "tasks"}} </small>{{team.name}}: {{duty.title}}</h5>
</template>

<template name="projectTitle">
  <h5 class="mb-1 mr-auto"><small>{{fa "calendar-o"}} </small>{{team.name}}: {{duty.title}}</h5>
</template>

<template name="leadTitle">
  <h5 class="mb-1 mr-auto"><small>{{fa "user-circle"}}</small> {{team.type}} {{__ ".lead"}}: {{team.name}}</h5>
</template>

<template name="leadBody">
  <div class="row no-gutters">
    <p class="card-text">{{duty.description}}</p>
  </div>
  <div class="row no-gutters">
    <h5 class="mb-2 text-muted">{{__ ".responsabilities"}}</h5>
    <p class="card-text"> {{duty.responsabilities}}</p>
  </div>
  <div class="row no-gutters">
    <h5 class="mb-2 text-muted">{{__ ".qualificatons"}}</h5>
    <p class="card-text">{{duty.qualificatons}}</p>
  </div>
</template>

<template name="shiftBody">
  <p class="card-text">{{duty.description}}</p>
</template>

<template name="taskBody">
  <p class="card-text">{{duty.description}}</p>
</template>

<template name="projectBody">
  <p class="card-text">{{duty.description}}</p>
</template>

<template name="projectSignupForm">
  <div class="container-fluid">
    <div class="row">
      {{#each day in projectDays}}
        <a class="col shift-day {{highlightClass @index}}" data-action="choose" data-index="{{@index}}"><h5>{{formatDate day }}</h5></a>
      {{/each}}
    </div>
  </div>
  <button class="btn" data-action="apply">apply</button>
</template>
